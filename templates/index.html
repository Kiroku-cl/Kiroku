<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HILO</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/static/base.css">
    <link rel="stylesheet" href="/static/index.css">
    <style>
        /* Ajustes para desktop con navbar */
        @media (min-width: 768px) {
            /* Ocultar elementos duplicados en header */
            header .header-left > .nav-link,
            header .header-left > h1,
            header .header-left > .header-divider {
                display: none;
            }
            header .header-left {
                gap: 0;
            }
            /* Ajustar altura del contenedor para dejar espacio a la navbar */
            .container {
                height: calc(100vh - 60px);
            }
        }
    </style>
</head>
<body>
    {% set active_page = 'record' %}
    {% set desktop_only = true %}
    {% include 'partials/navbar.html' %}

    <div class="container">
        <header>
            <div class="header-left">
                <a href="{{ url_for('pages.projects_page') }}" class="nav-link" title="Ver proyectos">
                    <i class="bi bi-folder2"></i>
                </a>
                <h1>HILO</h1>
                <span class="header-divider">/</span>
                <input type="text" id="project-input" placeholder="Sin título" maxlength="50">
            </div>
            <div class="status-bar">
                <span id="status" class="status">Detenido</span>
                <span id="timer" class="timer">00:00</span>
            </div>
        </header>

        <main class="main-content">
            <section class="left-panel">
                <pre id="transcript"></pre>
                <!-- Photo history -->
                <div id="photo-history" class="photo-history"></div>
            </section>

            <section class="right-panel">
                <div class="video-wrapper">
                    <video id="preview" autoplay muted playsinline></video>
                    <!-- Etiqueta de nombre clickeable -->
                    <div id="name-tag" class="name-tag" title="Click para editar">
                        <span class="name-tag-text">NOMBRE</span>
                        <i class="bi bi-pencil-fill name-tag-icon"></i>
                    </div>
                    <!-- Botón FOTO flotante sobre el video -->
                    <button id="btn-photo" class="btn-photo-floating" disabled>
                        <i class="bi bi-camera-fill"></i>
                    </button>
                </div>
                <!-- Botón cambiar cámara (solo mobile) -->
                <button id="btn-switch-camera" class="btn-switch-camera" title="Cambiar cámara">
                    <i class="bi bi-arrow-repeat"></i>
                </button>
                <!-- Botón config flotante (solo mobile) -->
                <button id="btn-settings" class="btn-settings-toggle" title="Configuración">
                    <i class="bi bi-gear"></i>
                </button>
                <!-- Panel de controles inferior -->
                <div class="bottom-controls">
                    <!-- Config (inline en desktop, flotante en mobile) -->
                    <div class="photo-config" id="photo-config">
                        <!-- Nombre (visible solo en mobile) -->
                        <div class="config-item config-name" title="Nombre del participante">
                            <i class="bi bi-person"></i>
                            <input type="text" id="name-input-config" placeholder="Nombre" maxlength="20">
                        </div>
                        <div class="config-item" title="Segundos antes de capturar">
                            <i class="bi bi-stopwatch"></i>
                            <button type="button" id="delay-minus" class="delay-btn">−</button>
                            <span id="photo-delay" class="delay-value">3</span>
                            <button type="button" id="delay-plus" class="delay-btn">+</button>
                        </div>
                        {% if current_user.can_stylize_images %}
                        <div class="config-item" title="Estilizar como dibujo">
                            <i class="bi bi-brush"></i>
                            <label class="switch">
                                <input type="checkbox" id="stylize-toggle" checked>
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        {% endif %}
                    </div>
                    <!-- Timer (solo mobile) -->
                    <div class="mobile-timer">
                        <span id="mobile-timer">00:00</span>
                    </div>
                    <!-- Botones -->
                    <div class="main-controls">
                        <!-- Solo mobile -->
                        <a href="/projects" class="btn-control btn-projects" title="Ver proyectos">
                            <i class="bi bi-folder2"></i>
                        </a>
                        <!-- Desktop y mobile -->
                        <button id="btn-start" class="btn btn-start" title="Iniciar/Detener">
                            <i class="bi bi-play-fill btn-icon-mobile"></i>
                            <span class="btn-text-desktop">START</span>
                        </button>
                        <button id="btn-pause" class="btn btn-pause" disabled title="Pausar">
                            <i class="bi bi-pause-fill btn-icon-mobile"></i>
                            <span class="btn-text-desktop">PAUSA</span>
                        </button>
                        <!-- Solo mobile -->
                        <button id="btn-photo-mobile" class="btn-control btn-photo-mobile" disabled title="Tomar foto">
                            <i class="bi bi-camera-fill"></i>
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de confirmación STOP -->
    <div id="stop-modal" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <h2 id="stop-modal-title">¿Qué quieres hacer?</h2>
            <p class="modal-subtitle" id="stop-modal-subtitle">La grabación está pausada</p>
            <div class="modal-actions">
                <button id="modal-finish" class="modal-btn modal-btn-primary">
                    <i class="bi bi-check-circle"></i>
                    Finalizar y procesar
                </button>
                <button id="modal-discard" class="modal-btn modal-btn-danger">
                    <i class="bi bi-trash"></i>
                    Descartar grabación
                </button>
                <button id="modal-continue" class="modal-btn modal-btn-secondary">
                    <i class="bi bi-play-circle"></i>
                    Continuar grabando
                </button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <script src="/static/app.js"></script>
</body>
</html>
